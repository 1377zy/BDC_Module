# Report Templates

The BDC Module includes a powerful template management system that allows users to create, edit, and use custom report templates.

## Overview

Report templates provide a way to customize the appearance of reports generated by the system. Templates can be created for different report types and can include custom headers, footers, and content sections.

## Features

- **Template Creation**: Create custom templates with branded headers, footers, and content sections
- **Template Preview**: Preview templates with sample data before using them
- **Template Selection**: Select templates when creating or editing scheduled reports
- **Report Type Filtering**: Templates are categorized by report type for easy selection
- **Default Templates**: Set default templates for each report type
- **PDF Generation**: Reports are generated using the selected template's styling and layout

## Using Report Templates

### Creating Templates

1. Navigate to Reports > Report Templates
2. Click "New Template"
3. Fill in the template details:
   - Name: A descriptive name for the template
   - Description: Optional description of the template's purpose
   - Report Type: Select the type of report this template is for
   - Header: Customize the header section (supports HTML)
   - Footer: Customize the footer section (supports HTML)
   - CSS Styles: Add custom CSS styles for the template
   - Options: Configure additional options like including logo, timestamp, etc.
4. Click "Save Template"

### Managing Templates

#### Setting a Default Template

1. From the templates list, find the template you want to set as default
2. Click the star icon (Set as Default) button
3. The template will now be automatically selected when creating new reports of that type
4. Only one template can be set as default for each report type

#### Duplicating Templates

1. From the templates list, find the template you want to duplicate
2. Click the copy icon (Duplicate Template) button
3. A new template will be created with "(Copy)" appended to the name
4. You can then edit the duplicated template as needed
5. This is useful for creating variations of a template without starting from scratch

### Previewing Templates

1. From the templates list, click the eye icon (Preview) button next to a template
2. The system will generate a preview using sample data for the selected report type
3. Review the preview to ensure the template looks as expected
4. Make adjustments to the template if needed

### Using Templates in Scheduled Reports

1. When creating or editing a scheduled report:
   - Select the report type
   - The system will automatically load templates available for that report type
   - Select a template from the dropdown
   - Click the "Preview" button to see how the report will look with the selected template
2. Complete the rest of the scheduled report form and save

### Setting Default Templates

1. Navigate to Reports > Report Templates
2. Find the template you want to set as default
3. Click the "Set as Default" button
4. The template will now be automatically selected when creating new reports of that type

## Template Export and Import

The BDC Module allows you to export and import report templates, making it easy to share templates between different instances of the application or create backups of your templates.

### Exporting Templates

There are two ways to export templates:

1. **Individual Template Export**
   - Click the export button (file icon) on any template card
   - The template will be exported as a JSON file with all its properties
   - The exported file will be named based on the template name with a unique identifier

2. **Bulk Template Export**
   - Click the "Import/Export" dropdown button in the top right of the template management page
   - Select "Bulk Export" from the dropdown menu
   - In the modal that appears, select the templates you want to export
   - Click "Export Selected" to download a JSON file containing all selected templates

### Importing Templates

There are two ways to import templates:

1. **Individual Template Import**
   - Click the "Import/Export" dropdown button in the top right of the template management page
   - Select "Import Template" from the dropdown menu
   - In the modal that appears, select a JSON file containing a single template
   - Click "Import" to add the template to your system

2. **Bulk Template Import**
   - Click the "Import/Export" dropdown button in the top right of the template management page
   - Select "Bulk Import" from the dropdown menu
   - In the modal that appears, select a JSON file containing multiple templates
   - Click "Import" to add all templates to your system

### Notes on Importing Templates

- If a template with the same name already exists, the imported template will have "(Imported)" appended to its name
- Imported templates are never automatically set as default templates
- The usage count for imported templates starts at 0
- The user who imports the template becomes the creator of the imported template

### Template Export Format

The exported JSON file contains all the information needed to recreate the template:

```json
{
  "name": "Template Name",
  "description": "Template Description",
  "report_type": "inventory",
  "header_html": "<h1>Header HTML</h1>",
  "footer_html": "<p>Footer HTML</p>",
  "css_styles": "body { font-family: Arial; }",
  "include_logo": true,
  "include_timestamp": true,
  "include_page_numbers": true,
  "export_date": "2025-03-02T19:38:33.123456",
  "export_version": "1.0"
}
```

For bulk exports, the format includes an array of templates:

```json
{
  "export_date": "2025-03-02T19:38:33.123456",
  "export_version": "1.0",
  "templates_count": 2,
  "templates": [
    {
      "name": "Template 1",
      "description": "Description 1",
      "report_type": "inventory",
      "header_html": "<h1>Header 1</h1>",
      "footer_html": "<p>Footer 1</p>",
      "css_styles": "body { font-family: Arial; }",
      "include_logo": true,
      "include_timestamp": true,
      "include_page_numbers": true
    },
    {
      "name": "Template 2",
      "description": "Description 2",
      "report_type": "sales",
      "header_html": "<h1>Header 2</h1>",
      "footer_html": "<p>Footer 2</p>",
      "css_styles": "body { font-family: Times; }",
      "include_logo": false,
      "include_timestamp": true,
      "include_page_numbers": false
    }
  ]
}
```

This feature is particularly useful for multi-location dealerships that want to maintain consistent reporting across all locations.

## Template Analytics

The BDC Module includes a comprehensive template analytics system that helps you track and analyze template usage. This feature is available to managers and administrators.

### Accessing Template Analytics

1. Navigate to Reports > Report Templates
2. Click the "Analytics" button in the top right corner

### Analytics Features

1. **Usage Overview**:
   - View total usage counts for each report type (Inventory, Leads, Sales, Performance)
   - See at a glance which types of templates are used most frequently

2. **Most Used Templates**:
   - View a list of the top 5 most frequently used templates
   - See usage counts for each template

3. **Unused Templates**:
   - Identify templates that have never been used
   - Preview these templates to determine if they should be updated or removed

4. **Recently Created Templates**:
   - View templates created in the last 30 days
   - Track usage of new templates

5. **Template Usage by Type**:
   - Visual chart showing the distribution of template usage across report types
   - Percentage breakdown of usage by type

6. **Detailed Usage Tables**:
   - Tabbed interface showing detailed information for each template
   - Sort by usage count to identify popular and unpopular templates
   - See which templates are set as defaults

### Using Analytics for Template Management

1. **Identify Popular Templates**:
   - Templates with high usage counts are popular and should be maintained
   - Consider using popular templates as a basis for new templates

2. **Identify Unused Templates**:
   - Templates with zero usage may need to be improved or removed
   - Preview unused templates to understand why they aren't being used

3. **Track New Templates**:
   - Monitor usage of newly created templates
   - If a new template isn't being used, consider making improvements

4. **Optimize Default Templates**:
   - Use analytics to identify which templates should be set as defaults
   - Popular templates are good candidates for default status

## Technical Implementation

- Templates are stored in the `ReportTemplate` model
- Preview functionality uses sample data for demonstration
- PDF generation uses WeasyPrint with custom CSS from templates
- Template selection is integrated with the scheduled reports workflow

## Best Practices

1. **Keep Templates Simple**: Avoid overly complex HTML and CSS to ensure compatibility with PDF generation
2. **Test Templates Thoroughly**: Always preview templates before using them in production
3. **Use Consistent Branding**: Maintain consistent branding across all templates
4. **Optimize for Printing**: Remember that reports may be printed, so use print-friendly styles
5. **Create Templates for Each Report Type**: Different report types may benefit from different layouts

## Troubleshooting

- If a template doesn't appear in the dropdown, ensure it's assigned to the correct report type
- If the preview doesn't look right, check the HTML and CSS for errors
- If the PDF generation fails, simplify the template and try again
